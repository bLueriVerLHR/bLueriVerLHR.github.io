# 时序逻辑电路

时序逻辑电路简称时序电路。构成时序电路的基本单元电路是触发器。

按照触发方式不同，将时序电路分成两类，一类是同步时序电路，另一类是异步时序电路。

- 同步时序电路中的所有触发器公用一个时钟信号，即所有触发器的状态转换发生在同一时刻。
- 异步时序电路不再公用一个时钟信号，有的触发器的时钟信号是另一个触发器的输出，就是所有触发器的状态转换不一定发生在同一时刻。

时序电路分为米里型和莫尔型两类，时序电路的输出状态与输入和现态有关的电路称为米里型，而输出状态只与现态有关的电路，则称为莫尔型。

## 时序电路的特点和表示方式

### 时序逻辑电路的特点

时序逻辑电路的特点是，电路的任意一个时刻的输出状态不仅取决于当前的输入信号，还取决于电路原来的状态，或者说与过去的输入有关。

既然时序电路的输出状态与原来状态有关，那么时序电路的构成中必须包含存储电路，而且存储电路的输出状态还必须与输入信号共同决定时序电路的输出状态。

> 时序电路的状态，是依靠存储电路来记忆表示的，时序电路中可以没有组合电路，但不能没有存储电路。

### 时序逻辑电路的表示方式

实际上，触发器就是一种简单的时序电路。

只是触发器的功能十分简单，一般情况下仅当作基本单元电路处理罢了，但表示触发器逻辑功能的几种方法，对于时序电路都是适用的。

#### 逻辑表达式

![时序逻辑电路框图](../../_media/pics/numerical_logic_system/4-1.png)

如图，$X$ 为组合电路的输入信号，$F$ 为组合电路的输出信号，$Z$ 为存储电路的输入信号，$Q$ 为存储电路的输出信号。

他们之间的关系可以用三个向量函数表示

$$F(t_n)=W[X(t_n),Q(t_n)],(4-1)$$
$$Q(t_{n+1})=G[Z(t_n),Q(t_n)],(4-2)$$
$$Z(t_n)=H[X(t_n),Q(t_n)],(4-3)$$

其中，$t_n$ 和 $t_{n+1}$ 表示两个相邻的离散时间。

- $F_1,F_2,\dots,F_j$ 是电路的输出信号，故把式 $(4-1)$ 称为输出方程。
- $Q_1,Q_2,\dots,Q_l$ 是存储电路的状态，称为状态变量，故把式 $(4-2)$ 称为状态方程。
- $Z_1,Z_2,\dots,Z_k$ 是存储电路的驱动或激励信号，故把式 $(4-3)$ 称为驱动方程，或激励方程。

#### 状态图、卡诺图、状态图和时序图

在时序电路中，由于时序电路的现态和次态，是由构成该时序电路的存储电路（一般由触发器组成）的现态和次态分别表示，因此可以用分析触发器的有关方法，列出时序电路的状态表，画出时序电路的卡诺图，状态图和时序图。

## 时序逻辑电路的分析方法

分析的目的，就是要找出给定的时序电路的逻辑功能。

时序电路分为同步时序电路和异步时序电路两类，相应的，时序电路分析方法也分为同步时序电路分析法和异步时序电路分析法。

他们的基本分析方法是一致的，不同之处在于，分析异步时序电路的时候，必须分析各触发器的时钟是否到来，只有时钟到来之后，方可求出次态。

分析步骤可以按照如下步骤进行：

1. 写出给定逻辑电路中每个触发器的驱动方程，即写出触发器输入信号的逻辑函数表达式。
2. 将各触发器的驱动方程代入各自的特性方程中，求得状态方程。
3. 写出给定逻辑电路的输出方程。
4. 求出在CP作用下的给定逻辑电路的状态转换图（状态转换表或波形图）。
    - 将输入变量和电路的初始状态的取值代入状态方程和输出方程，便可求出电路的次态和输出值；
    - 然后以求得的次态作为新的状态，与这时的输入变量取值一起，代入状态方程和输出方程，计算出新的次态和输出值；
    - 如此继续下去，把计算结果列成表的形式，就得到状态转换表。进而画出状态转换图或波形图。

## 寄存器

寄存器按照其功能特点分成数码寄存器和移位寄存器两类。

数码寄存器用来存放一组二值代码，而移位寄存器除了存储二值代码外，还具有移位功能，就是在脉冲作用下，将二值代码左移或右移，左移和右移的方向是对逻辑图而言的。

### 数码寄存器

数码寄存器有双拍和单拍两种工作方式。

- 双拍工作方式是指接收数码的过程分两步进行，第一步清零，第二步接收数码。
- 单拍的工作方式是指只需一个接收脉冲就可完成接收数码的工作方式。

由于双拍工作方式不仅操作不方便，还因为两步进行而限制了工作速度，因此，集成数码寄存器几乎都采用了单拍工作方式。

一个触发器只能存储一位二值代码，$N$ 个触发器构成的数码寄存器可以存储一组N位二值代码。

由于数码寄存器将输入代码存在数码寄存器中，因此要求数码寄存器所存的代码一定和输入的代码相同。因此，构成数码寄存器的触发器必定是D触发器。

由于数码寄存器由D触发器构成，因此集成数码寄存器常称为N位D触发器。

74LS175内部有4个D触发器。在时钟脉冲CP上升沿到来时，实现数据的并行输入-并行输出。

![74LS175数码寄存器的逻辑图](../../_media/pics/numerical_logic_system/4-2.png)

### 锁存器

锁存器也是一种存放数码的部件，它的特点如下：

- 当锁存信号没有到来时，锁存器的输出状态随着输入信号变化而变化（相当于输出直接接到输入端，即所谓“透明”）；
- 当锁存信号到达时，锁存器输出状态保持锁存信号跳变时的状态。

常用的锁存器有双二位锁存器、4位锁存器、双4位锁存器、8位透明锁存器、8位可寻址锁存器和多模式缓冲锁存器等。

![锁存器](../../_media/pics/numerical_logic_system/4-3.png)

如图，分别是8位D锁存器的逻辑图，引脚图和其中一位D锁存器的逻辑图。

我们可以知道当 $CP=0(\overline{CP}=1)$ 时，两个与或非门构成基本RS触发器。其输出如下：

$$Q=\overline{\overline{D}+\overline{Q}}$$
$$\overline{Q}=\overline{D+Q}$$

- 当 $D=0$ 时，将 $\overline{D}=1$ 代入 $Q$ 表达式中，则 $Q=0$；
- 若 $D=1$，将 $D=1$ 代入 $\overline{Q}$ 表达式中，则 $\overline{Q} = 0$。
- 再将 $\overline{D}=0$，$\overline{Q}=0$ 代入 $Q$ 表达式中，得到 $D=1$。

这说明

- 在锁存信号没到来，即 $CP=0$ 时，D锁存器的输出信号和输入信号一致，即 $Q=D$。
- 当CP从0变为1时候，由于 $\overline{CP}=0$，将 $\overline{D}$ 和 $D$ 信号封锁住，基本RS触发器的输出状态不会改变，则将CP上升沿到来时的Q状态（即D的状态）保持下来，实现锁存功能。

74LS373的输出级为三态非门。只有输出使能信号 $\overline{E}=0$ 时候，才有信号输出；而 $\overline{E}=1$ 时候，输出为高阻态。

综上述：

- 当 $CP=0$，$\overline{E}=0$ 时，$Q=D$。
- 当CP由0变为1时，即锁存信号到达时，Q的状态被锁存，保持CP上升沿到来时的输入信号状态。

### 移位寄存器

由于移位寄存器不仅可以存储代码，还可以将代码移位，因此移位寄存器除了存储代码之外，还可以用于数据的串行-并行转换、数据运算和数据处理等。

![4位右移位移寄存器逻辑图](../../_media/pics/numerical_logic_system/4-4.png)

![4位右移位移寄存器波形图](../../_media/pics/numerical_logic_system/4-5.png)

如上图，可以写出4位右移位移寄存器的一些状态方程。

$$Q_3^{n+1}=Q_2^n$$
$$Q_2^{n+1}=Q_1^n$$
$$Q_1^{n+1}=Q_0^n$$
$$Q_0^{n+1}=D_1$$

当CP上升沿同时作用于所有触发器时候，触发器输入端的状态都为现状。CP上升沿到达之后，各触发器按状态方程进行状态转换。

- 输入代码 $D_1$ 存入触发器 $F_0$
- $Q_1$ 按 $Q_0$ 原来的状态翻转
- $Q_2$ 按 $Q_1$ 原来状态翻转
- $Q_3$ 按 $Q_2$ 原来状态翻转

总的来看，移位寄存器中的代码一次右移了一位。

由波形图可以看出，经过4个CP周期后，串行输入的4位代码全部移入4位寄存器中，此时可以在4个触发器的4个输出端，并行输出4位代码。这种输入、输出方式称为**串行输入-并行输出**方式，用于代码的串行-并行转换。

如果继续加入4个时钟脉冲，移位寄存器中的4位代码就依次从串行输出端送出。数据从串行输入端送入，从串行输出端送出的工作方式，称为**串行输入-串行输出**方式。

若把移位寄存器中的4位数据看成并行数据，则从串行输出端输出数据，便实现了数据的并行-串行转换。这种工作方式称为**并行输入-串行输出**方式。

通常，集成移位寄存器除了具有位移功能之外，还附加有数据并行输入、保持、异步清零功能。

![4位双向移位寄存器74194中规模集成电路逻辑图](../../_media/pics/numerical_logic_system/4-6.png)

> 图中a，b，c，d为数据并行输入端，SR为右移串行输入端，SL为左移串行输入端，$Q_A$，$Q_B$，$Q_C$，$Q_D$ 为并行输出端。

4位双向移位寄存器74194中规模集成电路功能如下：

1. 清零。
    - $\overline{R_d}=0$ 时，触发器 $FF_A$，$FF_B$，$FF_C$，$FF_D$ 同时被清零。
    - 移位寄存器工作时候，$\overline{R_d}$ 应为高电平。
2. 送数。
    - 送数是指位移寄存器处于数据并行输入状态。
    - 当 $S_1=S_0=1$ 时，三个与门中，左、右两个与门被封锁，中间与门输入信号被选中
        - $S_A=a$，$R_A=\overline{a}$；
        - $S_B=b$，$R_B=\overline{b}$；
        - $S_C=c$，$R_C=\overline{c}$；
        - $S_D=d$，$R_D=\overline{d}$；
    - CP上升沿到达后，$Q_AQ_BQ_CQ_D=abcd$，实现了数据的并行输入。
3. 右移。
    - 当 $S_1S_0=01$ 时，左边与门输入信号被选中，$S_B=Q_A^n$，$R_B=\overline{Q_A^n}$，CP上升沿到达后，$Q_B^{n+1}=Q_A^n$，实现了数据右移。
4. 左移。
    - 当 $S_1S_0=10$ 时，右边与门输入信号被选中，$S_B=Q_C^n$，$R_B=\overline{Q_C^n}$，CP上升沿到达后，$Q_B^{n+1}=Q_C^n$，实现了数据左移。
5. 保持。
    - 当 $S_1=S_0=0$ 时，$A=1$，门 $G_1$ 被封锁，CP信号不能加到触发器时钟输入端，触发器状态不变，实现了数据保持。

综上述，74194工作状态如表所示：

![74194的工作状态表](../../_media/pics/numerical_logic_system/4-7.png)

## 计数器

计数器是一种累计时钟脉冲数的逻辑部件。计数器不仅用于时钟脉冲计数，还用于定时、分频、产生节拍脉冲以及数字运算等。计数器是应用最广泛的逻辑部件之一。

### 计数器分类

1. 按触发方式，可以把计数器分成同步计数器和异步计数器。
    - 对于同步计数器，输入时钟脉冲时触发器的翻转是同时进行的。
    - 对于异步计数器，输入时钟脉冲时触发器的翻转是不同时的。
2. 按计数容量（模数，基数，计数长度），可分成二进制计数器、十进制计数器、任意进制计数器（如十二进制、六十进制等）。
3. 按数的增减分类，可分成加法计数器、减法计数器和可逆计数器。
    - 随着计数脉冲不断输入计数器，进行递增计数的计数器称为加法计数器。
    - 随着计数脉冲不断输入计数器，进行递减计数的计数器称为减法计数器。
    - 随着计数脉冲不断输入计数器，既可以进行递增，又可以进行递减的计数器称为可逆计数器。

![二进制](../../_media/pics/numerical_logic_system/4-8.png)

![八进制](../../_media/pics/numerical_logic_system/4-9.png)

![十进制](../../_media/pics/numerical_logic_system/4-10.png)

![十进制加减法计数器](../../_media/pics/numerical_logic_system/4-11.png)

![2位二进制可逆计数器](../../_media/pics/numerical_logic_system/4-12.png)

可逆计数器又分为双时钟加/减计数器和单时钟加/减计数器。

- 双时钟加/减计数器适用于加法计数器脉冲和减法计数器脉冲分别来自两个不同脉冲源的情况。
- 单时钟加/减计数器只有一个时钟输入端。电路进行加法计数还是进行减法计数，将由加/减控制端的状态来决定。

### 二进制计数器

4位同步二进制加法计数器74161是典型的常用的中规模集成计数器。

![74161逻辑图和功能表](../../_media/pics/numerical_logic_system/4-13.png)

![74161波形图](../../_media/pics/numerical_logic_system/4-14.png)

![74161功能解释](../../_media/pics/numerical_logic_system/4-15.png)

### 十进制计数器

#### 8421编码十进制计数器

- 74160是TTL型常用十进制加法计数器；
- CD40160是MOS型十进制加法计数器。

74160和CD40160的功能完全一样，他们和74161的区别只是计数容量不同，其余功能和引脚完全一样，多片间的级联也一样。

![CD40160逻辑图和波形图](../../_media/pics/numerical_logic_system/4-16.png)

![CD40160功能表](../../_media/pics/numerical_logic_system/4-17.png)

#### 二-五-十进制异步计数器

二-五-十进制异步加法计数器74290如图

![二-五-十进制异步加法计数器74290](../../_media/pics/numerical_logic_system/4-18.png)

### 可逆计数器

可逆计数器也称为加/减计数器。

4位同步二进制加/减计数器中的74191，74169，CD4516采用单时钟结构，而74193，CD40193则采用双时钟结构。

同步十进制加/减计数器中的74190，74168，CD4510采用单时钟结构，而74192，CD40192则采用双时钟结构。

一个加/减法计数器只有一个计数脉冲输入端的，是单时钟结构，他是靠加/减控制端的控制来实现加法计数和减法计数的。

74190的功能

![74190的功能和波形图](../../_media/pics/numerical_logic_system/4-19.png)

![74190的外引线排列图](../../_media/pics/numerical_logic_system/4-20.png)

### 中规模集成计数器构成的任意进制的计数器

利用中规模集成计数器构成任意进制计数器的方法归纳起来有乘数法、复位法和置数法三种。

![乘数法](../../_media/pics/numerical_logic_system/4-21.png)

![复位法](../../_media/pics/numerical_logic_system/4-22.png)

![置数法](../../_media/pics/numerical_logic_system/4-23.png)

![置数法例子](../../_media/pics/numerical_logic_system/4-24.png)

### 移位寄存器型计数器

![环形计数器](../../_media/pics/numerical_logic_system/4-25.png)

![扭环形计数器](../../_media/pics/numerical_logic_system/4-26.png)

## 顺序脉冲发生器

顺序脉冲发生器也称节拍脉冲发生器。

顺序脉冲发生器能够产生一组在时间上有先后顺序的脉冲。用这组脉冲可以使控制器形成所需的各种控制信号，以便控制机器按照实现规定的顺序进行一系列操作。

![顺序脉冲发生器 1](../../_media/pics/numerical_logic_system/4-26.png)

![顺序脉冲发生器 2](../../_media/pics/numerical_logic_system/4-28.png)

![顺序脉冲发生器 3](../../_media/pics/numerical_logic_system/4-29.png)

![顺序脉冲发生器 4](../../_media/pics/numerical_logic_system/4-30.png)

![顺序脉冲发生器 5](../../_media/pics/numerical_logic_system/4-31.png)

## 时序逻辑电路的设计方法

时序电路设计，就是根据给定的逻辑问题，求出现实这一逻辑功能的时序电路。

时序电路设计步骤：

1. 画出状态图或状态转换表。
    - 要画出状态转换图，首先得确定输入变量、输出变量和状态数。通常，取原因或条件作为输入变量，取结果作为输出变量。
    - 其次对输入、输出和电路状态进行定义，并对电路状态顺序进行编号。
    - 最后按照命题要求画出转换图或状态转换表。
2. 状态化简。
    - 在第一步得到的状态状态转换图中可能包含有等价状态，因此需进行状态化简。两个或多个等价状态可以合并成一个状态。
    - 若两个状态在输入相同条件下，转换到同一个次态，而且得到相同的输出，则这两个状态为等价状态。
3. 状态分配。
    - 时序电路的状态，通常用触发器的状态组合来表示，因此要先确定触发器的数目。因为n个触发器有 $2^n$ 种状态组合，所以要得到M个状态组合，即电路状态数，必须取 $2^{n-1}<M\leq 2^n$。
    - 其次要给电路的每个状态规定与之对应的触发器状态组合。由于每一组触发器的状态组合都是一组二值代码，所以状态分配也称为状态编码。
4. 确定触发器类型并求出驱动方程和输出方程。
    - 因为不同逻辑功能的触发器的特性方程不同，所以只有选定触发器之后，才能求出状态方程，进而求出驱动方程和输出方程。
5. 按照驱动方程和输出方程画出逻辑图。
6. 检查所设计的电路能否自启动。
    - 无效状态能够在时钟脉冲作用下进入有效循环中，说明该电路能够自启动，否则电路不能自启动。
    - 如果检查的结果是电路不能自启动，就要修改设计，使它能够自启动。
    - 另外，还可以在电路开始工作的时候，将电路的状态置成有效循环中的某一状态。
