# 概述

<!-- TODO: 概述信息 -->

# 物理层

## 物理层的基本概念

物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流。（并不是指具体的传输媒体）

物理层的作用是要尽可能地屏蔽掉传输媒体和通信手段的差异，使得物理层上面的数据链路层感觉不到这些差异，这样就可以使得数据链路层只需要考虑如何完成本层的协议和服务。

用于物理层的协议也常称为物理层的 **规程（procedure）**。

> 其实物理层规程就是物理层协议。只是“协议”这个名词出现之前，人们就先使用了“规程”这一名词。

可以将物理层的主要任务描述为确定与传输媒体的接口有关的一些特性，也即：

1. 机械特性 - 指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。
2. 电气特性 - 指明在接口电缆的各条线上出现的电压的范围。
3. 功能特性 - 指明某条线上出现的某一电平的电压的意义。
4. 过程特性 - 指明对于不同功能的各种可能事件的出现顺序。

数据在通信线路（传输媒体）上的传输方式一般是 **串行传输**（出于经济上的考量），即逐个比特按照时间顺序传输。因此物理层还要完成传输方式的转换。

> 具体物理层协议种类较多。因为物理连接的方式很多（如点对点的、多点连接或广播连接），而传输媒体的种类也非常之多（如架空明线、双绞线、对称电缆、同轴电缆、光缆，以及各种波段的无线信道等。

## 数据通信的基础知识

### 数据通信系统的模型

一个数据通信系统可以划分成三大部分，即源系统（或发送端、发送方）、传输系统（或传输网络）和目的系统（或接收方、接收端）。

源系统一般包括一下两个部分：

- 源点（source） - 源点设备产生要传输的数据，例如从计算机的键盘输入文字，计算机产生输出的数字比特流。源点又称为 **源站**，或 **信源**。
- 发送器 - 通常源点生成的数字比特流要通过发送器编码后才能够在传输系统中进行传输。典型的发送器就是调制器。现在计算机使用内置的调制解调器（包括调制器和解调器），用户在计算机外部是看不到调制解调器的。

目前的系统一般也包括以下两个部分：

- 接收器 - 接收传输系统传过来的信号，并将其转换为能够被目的设备处理的信息。典型的接收器就是解调器，它把来自传输线路上的模拟信号进行解调，提取出在发送端置入的消息，还原出发送端产生的数字比特流。
- 终点（destination） - 终点设备从接收器获取传送来的数字比特流，然后把信息输出。终点又称为 **目的站**，或 **信宿**。

在源系统和目的系统之间的传输系统可以是简单的传输线，也可以是连接在源系统和目的系统之间的复杂网络系统。

接下来介绍一些常用术语：

通信的目的是传送 **消息**（message）。如话音、文字、图像、视频等都是消息。

**数据**（data）是运送消息的实体。根据 [RFC 4949](https://www.rfc-editor.org/pdfrfc/rfc4949.txt.pdf) 给出的定义，数据是使用特定方式表示的信息，通常是有意义的符号序列。这种信息表示可用计算机或其他机器（或人）处理或产生。

> rfc 4949 [Page 93]
> 
> $ data
> 
> (I) Information in a specific representation, usually as a
> sequence of symbols that have meaning.
> 
> Usage: Refers to both (a) representations that can be recognized,
> processed, or produced by a computer or other type of machine, and
> (b) representations that can be handled by a human.

信号（signal）则是数据的电气和电磁的表现。

根据信号中代表消息的参数的取值方式不同，信号可分为以下两大类：

1. 模拟信号，或连续信号 - 代表消息的参数的取值是连续的。如用户家中的调制解调器到电话端局之间的用户线上传送的就是模拟信号。
2. 数字信号，或离散信号 - 代表消息的参数的取值是离散的。如用户家中的计算机到调制解调器之间，或电话网中继线上传送的就是数字信号。

在使用时间域（或简称时域）的波形表示数字信号时，代表不同离散数值的基本波形就称为 **码元**。

> 一个码元所携带的信息量是不固定的，而是由调制方式和编码方式决定的。在使用二进制编码时，只有两种不同的码元，一种代表 0 状态，而另一种代表 1 状态。

### 有关信道的几个基本概念

**信道**（channel）和电路并不等同。信道一般都是用来表示向某一个方向传送信息的媒体。因此。一条通信电路往往包含一条发送信道和一条接收信道。

从通信双方的信息方式来看，可以由以下三种基本方式：

1. 单向通信 - 又称为单工通信，即只有一个方向的通信而没有反方向的交互。无线电广播或有线电广播以及电视广播就属于这种类型。
2. 双向交替通信 - 又称为半双工通信，即通信的双方都可以发送消息，但不能双方同时发送（当然也就不能同时接收）。这种通信方式是一方发送另一方接收，过一段事件后可以再反过来。比如对讲机。
3. 双向同时通信 - 又称为全双工通信，即通信的双方都可以同时发送和接收信息。

单向通信只需要一条信道，而双向通信或双向同时通信则都需要两条信道。显然，双向同时通信的传输效率最高。

> 有时人们也常用“单工”这个名词表示“双向交替通信”。如常说的“单工电台”，并不是只能进行单向通信。

来自信源的信号常称为 **基带信号**（即基本频带信号）。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。

基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。为解决这一个问题，就必须对基带信号进行 **调制**（modulation）。

调制可分为两大类。

一类是仅仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。这类调制称为基带调制。由于这种基带调制是把数字信号转换为另一种形式的数字信号，因此该过程也叫 **编码**（coding）。

另一类调制则需要使用 **载波**（carrier）进行调制，把基带信号的频率范围搬移到较高频段，并转换为模拟信号，这样就能更好地在模拟信道中传输。经过载波调制后的信号称为 **带通信号**（即仅在一段频率范围内能够通过信道），而使用载波的调制称为 **带通调制**。

**（1）常用编码方式**

- 不归零制 - 正电平代表 1，负电平代表 0。
- 归零制 - 正脉冲代表 1，负电平代表 0。
- 曼彻斯特编码 - 位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。但也可以反过来定义。
- 差分曼彻斯特编码 - 在每一位的中心处始终都有跳变。位开始边界有跳变代表 0，而位开始边界没有跳变代表 1。

若对比其生成的波形可以看出：

- 从信号波形中可以看出，曼彻斯特（Manchester）编码产生的信号频率比不归零制高。
- 从自同步能力可以看出，不归零制不能从信号波形本身中提取信号时钟频率（这叫做没有自同步能力），而曼彻斯特编码具有自同步能力。

资料：

- <https://en.wikipedia.org/wiki/Manchester_code>

**（2）基本的带同调制方法**

- 调幅（AM） - 即载波的振幅随基带数字信号而变化。例如，0 或 1 分别对应于无载波或有载波输出。
- 调频（FM） - 即载波的频率随基带数字信号而变化。例如，0 或 1 分别对应于频率 $f_1$ 或 $f_2$。
- 调相（PM） - 即载波的初始相位随基带数字信号而变化。例如，0 或 1 分别对应于相位 0 度或 180 度。

为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调制方法。例如，**正交振幅调制QAM**（Quadrature Amplitude Modulation）。

### 信道的极限容量

数字通信的优点：虽然信号在信道上传输时候会不可避免地产生失真，但在接收端只要能从失真的波形中能够识别出原来的信号，那么这种失真对通信质量就没有影响。

码元传输的速率越高，或信号传输的距离越远，或噪声干扰越大，或传输媒体质量越差，在接收端的波形失真就越严重。

从概念上讲，限制码元在信道上的传输速率的因素有以下两个：

**（1）信道能够通过的频率范围**

具体的信道所能通过的频率范围总是有限的。信号中的许多高频分量往往不能通过信道。

一种典型的受干扰现象是 [码间串扰](https://en.wikipedia.org/wiki/Intersymbol_interference)。

在 1924 年，奈奎斯特（Nyquist）推导出了著名的 [奈氏准则](https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem)。他给出了在假定的理想条件下，为了避免码间串扰，码元的传输速率的上限值：在任何信道中，码元传输的速率是有上限的，传输速率超过此上限，就会出现严重的码间串扰的问题，使接收端对码元的判决（即识别）成为不可能。

如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以用更高的速率传送码元而不出现码间串扰。

**（2）信噪比**

噪声存在于所有的电子设备和通信信道中。由于噪声是随机产生的，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误。

噪声的影响是相对的。如果信号相对较强，那么噪声的影响就相对较小。因此，信噪比就很重要。

信噪比就是信号的平均功率和噪声的平均功率之比，常记为 $S/N$，并用分贝（dB）作为度量单位。即：

$$
ratio \space (dB) = 10 \log_{10}{(S/N)} (dB)
$$

在 1948 年，信息论创始人香农（Shannon）推导出了著名的 **香农公式**。香农公式指出：

信道的极限信息传输速率 C 是

$$
C = W \log_{2}{(1+S/N)} (bit/s)
$$

式中，$W$ 为信道的带宽（以 Hz 为单位）；$S$ 为信道内所传信号的平均功率；$N$ 为信道内部的高斯噪声功率。

香农公式表明：**信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高。**

香农公式指出了信息传输速率的上限。香农公式的意义在于：只要信息传输速率低于信道的极限信息传输速率，就一定存在某种办法来实现无差错的传输。

对于频带宽度已经确定的信道，如果信噪比也不能再提高，并且码元传输速率也达到了上限值，那么还可以使用编码的方式，**让每个码元携带更多比特信息量** 的方式提高信息的传输速率。

## 物理层下的传输媒体

**传输媒体** 也称为传输介质或传输媒介，它是数据传输系统中在发送器和接收器之间的物理通路。传输媒体也可分为两大类，即 **导引型传输媒体** 和 **非导引型传输媒体**（这里的“导引型”为英文中的 guided，也可以翻译为“导向传输媒体”）。

在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或者光纤）传播。而非导引型传输媒体中电磁波的传播常常称为无线传输。

### 导引型传输媒体

**1. 双绞线**

双绞线也称为双扭线，是最古老但是又最常用的传输媒体。把两根互相绝缘的铜导线并排放在一起，然后用规则的方法绞合（twist）起来就构成了双绞线。绞合可以减少对相邻导线的电磁干扰。使用双绞线最多的地方就是到处都有的电话系统。

几乎所有的电话都用双绞线连接到电话交换机。这段从用户电话机到交换机的双绞线称为 **用户线** 或 **用户环路**（subscriber loop）。通常将一定数量的这种双绞线捆成电缆，在其外包上护套。

模拟传输和数字传输可以使用双绞线。

# 数据链路层

## 使用点对点信道的数据链路层

## 点对点协议 PPP

## 使用广播信道的数据链路层

广播信道可以进行一对多的通信。

### 局域网的数据链路层

局域网最主要的特点就是：**网络为一个单位拥有，且地理范围和站点数目均有限。**

局域网具有如下一些主要优点：

1. 具有广播功能，从一个站点可以很方便的访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
2. 便于系统的拓展和逐渐演变，各设备的位置可灵活调整和改变。
3. 提高了系统的可靠性（reliability）、可用性（availability）和生存性（survivability）。

局域网可按网络拓扑进行分类。

- 星型网
  - 由于集线器（hub）的出现和双绞线大量用于局域网中，星形以太网以及多级星形结构的以太网获得了非常广泛的应用。
- 环型网
- 总线网
  - 各站直接连在总线上。
  - 总线两端的匹配电阻吸收在总线上传播的电磁波信号的能量，避免在总线上产生有害的电磁波反射。
  - 总线网以传统以太网最为著名。

> 由于以太网的进入市场，以太的快速发展使得其在局域网市场里占据了绝对优势。现在以太网几乎成为局域网的同义词。

局域网可使用多种传输媒体。双绞线最便宜，且已经从原来只用于低俗基带局域网发展到 10MB/s 到 10GB/s 的局域网都可使用双绞线。双绞线已成为局域网中的主流传顺媒体。当数据率很高的时候，往往需要使用光纤作为传输媒体。

> 局域网工作的层次跨越了数据链路层和物理层。

共享信道要着重考虑的一个问题就是如何使众多用户能够合理而方便的共享通信媒体资源。这在技术上有两种方法：

1. 静态划分信道。频分复用、时分复用、波分复用和码分复用等。用户只要分配到了信道就不会和其他用户发生冲突。但这种划分信道的方法代价较高，不适用于局域网使用。
2. 动态媒体接入控制，又称为多点接入（multiple access），其特点是信道并非在用户通信时固定分配给用户。其又分为两类：
   1. 随机接入，随机接入的特点是所有用户可随机地发送信息。但如果恰巧有两个或更多的用户在同一时刻发送信息，那么在共享媒体上就要产生碰撞（即发生了冲突），使得这些用户的发送都失败。因此，必须有解决碰撞的网络协议。
   2. 受控接入，受控接入的特点是用户不能随机地发送信息而必须服从一定的控制。这类的典型代表有分散控制的令牌环局域网和集中控制的多点路线探询（polling），或称为轮询。

> 通常使用传统以太网来表示 10MB/s 速率的以太网。

**1. 以太网的两个标准**

<!-- TODO: 以太网历史 -->

IEEE 802 委员会将局域网数据链路层拆成两个子层：

- 逻辑链路控制 LLC（Logical Link Control）子层
- 媒体接入控制 MAC（Medium Access Control）子层

**2. 适配器的作用**

### CSMA/CD 协议

### 使用集线器的星形拓扑

### 以太网的信道利用率

### 以太网的 MAC 层

**1. MAC 层的硬件地址**

在局域网中，硬件地址又称为物理地址或 MAC 地址（因为这种地址用在 MAC 帧中）。

在所有计算机系统的设计中，标识系统都是一个核心问题。在标识系统中，地址就是识别某个系统的一个非常重要的标识符，在讨论地址问题时，很多人常常引用著名文献 _Inter-network Naming, Addressing, and Routing_ 给出的如下定义：

**名字指出我们所要寻找的那个资源，地址指出那个资源在何处，路由告诉我们如何到达该处。**

严格的说，名字应当与系统所在地无关。但是 IEEE 802 标准为局域网规定一种 48 位的全球地址（一般简称为“地址”），是指局域网上的每一台计算机中固化在适配器的 ROM 中的地址。因此，

1. 假定连接在局域网上的一台计算机的适配器坏了，而接下来更换一个新的适配器，那么这台计算机的局域网的“地址”也就改变了。虽然这台计算机的地理位置一点都没有改变，所接入的局域网也没有任何改变。
2. 假定将一台计算机从地理位置 A 带到地理位置 B，