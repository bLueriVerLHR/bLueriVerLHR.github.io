> 《计算机图形学基础》
> 第三版
> 陆枫 何云峰 编著
> 电子工业出版社

# 绪论

# 基本图形生成算法

## 多边形的扫描转换与区域填充

### 多边形的扫描转换

在计算机图形学中，多边形有两种重要的表达方式：

1. 顶点表示
2. 点阵表示

其中，顶点表示用多边形的顶点序列来刻画多边形：

- 直观
- 几何意义强
- 占用内存少
- 应用很普遍
- 由于它没有明确指出哪些像素在多边形内，故不能直接用于面着色

点阵表示用位于多边形内的像素的几何来刻画多边形：

- 失去了许多重要的几何信息（如顶点、几何边界等）
- 方便于运用帧缓存表示图形，是面着色所需要的图形表示形式

多边形的扫描转换（或多边形的填充）是将多边形从顶点表示转换到点阵表示的过程，也即从多边形的定点信息出发，求出其内部的各个像素，并将其颜色值写入帧缓存的相应单元中。

二维多边形的扫描转换是三维多边形面着色方法的基础。

**x-扫描线算法**

x-扫描线算法填充多边形的基本思想是，按照扫描线顺序，计算扫描线与多边形的相交区间，再要用要求的颜色显示这些区间的像素，即完成填充工作。区间的端点可以通过计算扫描线与多边形边界线的交点获得。

x-扫描线算法可以填充：

- 凸的多边形
- 凹的多边形
- 带有孔的多边形

算法的核心是按 x 递增顺序排列交点的 x 坐标序列。由此可得到算法步骤如下：

1. 确定多边形顶点的最大和最小值（$y_{min}$ 和 $y_{max}$），得到多边形所占有的最大扫描线数。
2. 从 $y=y_{min}$ 到 $y=y_{max}$，每次用一条扫描线填充。每条线填充的过程如下：
   1. 求交，计算扫描线与多边形所有边的交点；
   2. 排序，把所有交点按 x 坐标递增的顺序进行排序；
   3. 交点配对，配对第一个与第二个、第三个与第四个交点等，每对交点都代表扫描线与多边形的一个相交区间；
   4. 区间填色，把这些相交区间内的像素置成不同于背景色的填充色。

通常，为避免多边形区域的扩大化，需要对交点进行处理，处理规则如下：

- 如果求出的交点的 x 坐标不是整数，则进行取整处理。
  - 当该交点处于区间的左边界上时，x 坐标向右取整；
  - 当该交点处于区间的右边界上时，x 坐标向左取整。
- 如果求出的交点是整数，则按照“左闭右开”的原则处理，即
  - 若交点处于左边界上，交点不变；
  - 若交点位于右边界上，交点的 x 坐标减 1。

一般，每条扫描线与多边形的交点个数为偶数。但是，当扫描线与多边形顶点相交时候，交点的个数可能为奇数。（也即可能有点的重合）解决方法如下：

- 当扫描线与多边形的顶点相交时候，若共享顶点的两边分别落在扫描线的两侧，交点只算一个；
- 若共享顶点的两条边在扫描线的同一侧，这时交点记为 0 个或 2 个。

后一种情况亦可以认为是对多边形的局部最高点和最低点进行偶数化处理。

x-扫描线算法在处理每条扫描线时，需要与多边形所有边求交，这样处理效率很低。因为一条扫描线往往只与少数几条边相交，甚至与整个多边形都不相交。这就可能会造成无用处理。